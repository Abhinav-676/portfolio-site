name: Lighthouse
on:
    workflow_run:
      workflows: ["Deploy"]
      types:
        - completed
jobs:
  lighthouse:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    if: github.event.deployment_status.state == 'success' && github.event.deployment_status.creator.login == 'deno-deploy[bot]'

    env:
      URL: ${{ github.event.deployment_status.environment_url }}

    steps:
        - name: Setup repo
          uses: actions/checkout@v4

        - name: Audit URLs using Lighthouse
          uses: treosh/lighthouse-ci-action@v11
          with:
            temporaryPublicStorage: true
            urls: |
              $URL
